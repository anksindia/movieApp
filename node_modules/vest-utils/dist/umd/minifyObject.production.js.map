{"version":3,"file":"minifyObject.production.js","sources":["../../src/isArrayValue.ts","../../src/isNumeric.ts","../../src/lengthEquals.ts","../../src/numberEquals.ts","../../src/isNullish.ts","../../src/isNull.ts","../../src/isUndefined.ts","../../src/valueIsObject.ts","../../src/isEmpty.ts","../../src/hasOwnProperty.ts","../../src/exports/minifyObject.ts","../../src/isFunction.ts","../../src/isStringValue.ts"],"sourcesContent":["import bindNot from 'bindNot';\n\n// The module is named \"isArrayValue\" since it\n// is conflicting with a nested npm dependency.\n// We may need to revisit this in the future.\n\nexport function isArray(value: unknown): value is Array<unknown> {\n  return Boolean(Array.isArray(value));\n}\n\nexport const isNotArray = bindNot(isArray);\n","import bindNot from 'bindNot';\n\nexport function isNumeric(value: string | number): boolean {\n  const str = String(value);\n  const num = Number(value);\n  const result =\n    !isNaN(parseFloat(str)) && !isNaN(Number(value)) && isFinite(num);\n  return Boolean(result);\n}\n\nexport const isNotNumeric = bindNot(isNumeric);\n","import bindNot from 'bindNot';\nimport { numberEquals } from 'numberEquals';\n\nexport function lengthEquals(\n  value: string | unknown[],\n  arg1: string | number,\n): boolean {\n  return numberEquals(value.length, arg1);\n}\n\nexport const lengthNotEquals = bindNot(lengthEquals);\n","import bindNot from 'bindNot';\nimport { isNumeric } from 'isNumeric';\n\nexport function numberEquals(\n  value: string | number,\n  eq: string | number,\n): boolean {\n  return isNumeric(value) && isNumeric(eq) && Number(value) === Number(eq);\n}\n\nexport const numberNotEquals = bindNot(numberEquals);\n","import bindNot from 'bindNot';\nimport { isNull } from 'isNull';\nimport { isUndefined } from 'isUndefined';\nimport { Nullish } from 'utilityTypes';\n\nexport function isNullish(value: any): value is Nullish {\n  return isNull(value) || isUndefined(value);\n}\n\nexport const isNotNullish = bindNot(isNullish);\n","import bindNot from 'bindNot';\n\nexport function isNull(value: unknown): value is null {\n  return value === null;\n}\n\nexport const isNotNull = bindNot(isNull);\n","import bindNot from 'bindNot';\n\nexport function isUndefined(value?: unknown): value is undefined {\n  return value === undefined;\n}\n\nexport const isNotUndefined = bindNot(isUndefined);\n","import { isNullish } from 'isNullish';\n\nexport function isObject(v: any): v is Record<any, any> {\n  return typeof v === 'object' && !isNullish(v);\n}\n","import bindNot from 'bindNot';\nimport hasOwnProperty from 'hasOwnProperty';\nimport { lengthEquals } from 'lengthEquals';\nimport { isObject } from 'valueIsObject';\n\nexport function isEmpty(value: unknown): boolean {\n  if (!value) {\n    return true;\n  } else if (hasOwnProperty(value, 'length')) {\n    return lengthEquals(value as string | unknown[], 0);\n  } else if (isObject(value)) {\n    return lengthEquals(Object.keys(value as Record<string, unknown>), 0);\n  }\n\n  return false;\n}\n\nexport const isNotEmpty = bindNot(isEmpty);\n","/**\n * A safe hasOwnProperty access\n */\nexport default function hasOwnProperty<T>(\n  obj: T,\n  key: string | number | symbol,\n): key is keyof T {\n  return Object.prototype.hasOwnProperty.call(obj, key);\n}\n","import { isArray } from 'isArrayValue';\nimport { isEmpty } from 'isEmpty';\nimport isFunction from 'isFunction';\nimport { isNullish } from 'isNullish';\nimport isStringValue from 'isStringValue';\nimport { isObject } from 'valueIsObject';\n\n// Basic key generator that generates keys like a, b, c, ... aa, ab, ac, ...\nfunction genMinifiedKey() {\n  const chars =\n    '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&*';\n  let index = 0;\n\n  return function next(): string {\n    let code = '';\n    let x = index;\n\n    do {\n      code = code + chars[x % chars.length];\n      x = Math.floor(x / chars.length);\n    } while (x > 0);\n    index++;\n    return code;\n  };\n}\n\nexport function minifyObject(\n  obj: any,\n  replacer: MinifyObjectReplacer = v => v,\n): [any, any] {\n  const countMap = new Map<any, number>();\n  countOccurrences(obj, countMap, replacer);\n  const maps = genMap(countMap);\n  const o = minifyObjectImpl(obj, maps.map, replacer);\n  // need to reverse the map so that the minified keys are the keys and the original keys are the values\n  // and turn it into an object\n\n  return [o, maps.reverseMap];\n}\n\nfunction genMap(countMap: Map<any, number>) {\n  const counts = [];\n\n  for (const [value, count] of countMap) {\n    if (count > 1) {\n      counts.push({ value, count });\n    }\n  }\n\n  const sorted = counts.sort((a, z) => z.count - a.count);\n\n  const getKey = genMinifiedKey();\n  return sorted.reduce(\n    (maps, { value }) => {\n      if (!shouldAddToMap(value, maps.keyLength)) {\n        return maps;\n      }\n\n      let key;\n      do {\n        key = getKey();\n      } while (countMap.has(key));\n      maps.map.set(value, key);\n      maps.reverseMap[key] = value;\n      maps.keyLength = key.length;\n      return maps;\n    },\n    {\n      map: new Map(),\n      reverseMap: {},\n      keyLength: 1,\n    } as {\n      map: Map<any, string>;\n      reverseMap: Record<string, any>;\n      keyLength: number;\n    },\n  );\n}\n\n// This avoids minification if the original key is shorter than or equals the minified key\nfunction shouldAddToMap(value: any, keyLength: number) {\n  return value.toString().length >= keyLength;\n}\n\nfunction addCount(value: any, countMap: Map<any, number>) {\n  countMap.set(value, (countMap.get(value) || 0) + 1);\n}\n\nfunction countOccurrences(\n  obj: any,\n  countMap: Map<any, number>,\n  replacer: MinifyObjectReplacer,\n) {\n  for (const key in obj) {\n    const value = replacer(obj[key], key);\n    if (!shouldMinify(value)) continue;\n\n    if (!Array.isArray(obj)) {\n      addCount(key, countMap);\n    }\n\n    if (isObject(value)) {\n      countOccurrences(value, countMap, replacer);\n    } else {\n      addCount(value, countMap);\n    }\n  }\n}\n\nfunction isNonSerializable(value: any): boolean {\n  return isNullish(value) || isFunction(value) || typeof value === 'symbol';\n}\n\n// eslint-disable-next-line complexity\nfunction shouldMinify(value: any): boolean {\n  if (isObject(value) && isEmpty(value)) {\n    return false;\n  }\n\n  if (isNonSerializable(value)) {\n    return false;\n  }\n\n  if (isObject(value) && isEmpty(value)) {\n    return false;\n  }\n\n  return true;\n}\n\nfunction minifyObjectImpl(\n  obj: any,\n  map: Map<any, string>,\n  replacer: MinifyObjectReplacer,\n): any {\n  const minifiedObject: any = getRootNode(obj);\n\n  for (const key in obj) {\n    const value = replacer(obj[key], key);\n    if (!shouldMinify(value)) continue;\n\n    let minifiedValue;\n    if (isObject(value)) {\n      minifiedValue = minifyObjectImpl(value, map, replacer);\n    } else {\n      minifiedValue = minifyValue(value, map);\n    }\n\n    setValue(minifiedObject, minifiedValue, minifyValue(key, map));\n  }\n\n  return minifiedObject;\n}\n\nfunction minifyValue(value: any, map: Map<any, string>) {\n  return map.get(value) ?? value;\n}\n\nfunction expandSingle(value: any, map: Record<string, any>): any {\n  if (isStringValue(value)) {\n    return map[value] ?? value;\n  }\n\n  return value;\n}\n\nexport function expandObject(minifiedObj: any, map: Record<string, any>): any {\n  const expandedObject: any = getRootNode(minifiedObj);\n\n  for (const key in minifiedObj) {\n    let expandedValue;\n    const value = minifiedObj[key];\n    if (isObject(value)) {\n      expandedValue = expandObject(value, map);\n    } else {\n      expandedValue = expandSingle(value, map);\n    }\n\n    const expandedKey = expandSingle(key, map);\n    setValue(expandedObject, expandedValue, expandedKey);\n  }\n\n  return expandedObject;\n}\n\nfunction setValue(container: any, value: any, key: string) {\n  if (isArray(container)) {\n    container.push(value);\n  } else {\n    container[key] = value;\n  }\n}\n\nfunction getRootNode(node: any) {\n  return isArray(node) ? [] : {};\n}\n\nexport type MinifyObjectReplacer = (value: any, key: string) => any;\n","export default function isFunction(\n  value: unknown,\n): value is (...args: unknown[]) => unknown {\n  return typeof value === 'function';\n}\n","export default function isStringValue(v: unknown): v is string {\n  return String(v) === v;\n}\n"],"names":["isArray","value","Boolean","Array","isNumeric","str","String","num","Number","result","isNaN","parseFloat","isFinite","lengthEquals","arg1","eq","numberEquals","length","isNullish","isNull","undefined","isUndefined","isObject","v","isEmpty","obj","key","Object","prototype","hasOwnProperty","call","keys","addCount","countMap","set","get","countOccurrences","replacer","shouldMinify","isFunction","isNonSerializable","minifyObjectImpl","map","minifiedObject","getRootNode","minifiedValue","minifyValue","setValue","_a","expandSingle","container","push","node","expandObject","minifiedObj","expandedObject","expandedValue","Map","maps","counts","count","sorted","sort","a","z","getKey","chars","index","code","x","Math","floor","genMinifiedKey","reduce","keyLength","toString","shouldAddToMap","has","reverseMap","genMap"],"mappings":"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"}